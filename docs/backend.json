{
  "entities": {
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents a user's expense within the Anualize application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense. (Primary Key)"
        },
        "uid": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Expense)"
        },
        "year": {
          "type": "number",
          "description": "The year the expense belongs to (e.g., 2025)."
        },
        "dueDate": {
          "type": "number",
          "description": "The day of the month the expense is due (1-31)."
        },
        "description": {
          "type": "string",
          "description": "A description of the expense."
        },
        "archived": {
          "type": "boolean",
          "description": "Indicates whether the expense is archived (soft deleted)."
        },
        "values": {
          "type": "array",
          "description": "Monetary values for each month of the year. Index matches months array, with Jan = 0.",
          "items": {
            "type": "number"
          }
        },
        "paymentStatuses": {
          "type": "array",
          "description": "Payment statuses (true = paid, false = pending) for each month. Index matches months array, with Jan = 0.",
          "items": {
            "type": "boolean"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the expense was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "uid",
        "year",
        "dueDate",
        "description",
        "archived",
        "values",
        "paymentStatuses",
        "createdAt"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Anualize application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.  This corresponds to the Firebase Auth UID. (Primary Key)"
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/usuarios/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Armazena informações do perfil do usuário. O 'userId' corresponde ao UID do Firebase Auth.",
          "params": [
            {
              "name": "userId",
              "description": "O identificador único do usuário, correspondente ao UID do Firebase Auth."
            }
          ]
        }
      },
      {
        "path": "/usuarios/{userId}/despesas/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Armazena os documentos de despesas de um usuário específico. Inclui o campo 'uid' que deve corresponder ao parâmetro de caminho 'userId' para autorização.",
          "params": [
            {
              "name": "userId",
              "description": "O identificador único do usuário, correspondente ao UID do Firebase Auth."
            },
            {
              "name": "expenseId",
              "description": "O identificador único para o documento de despesa."
            }
          ]
        }
      }
    ],
    "reasoning": "A estrutura do Firestore foi projetada para armazenar as despesas do usuário anualmente. As despesas são armazenadas em uma coleção específica do usuário para garantir privacidade e segurança dos dados. A estrutura prioriza a Independência de Autorização para permitir operações seguras e atômicas. Ao armazenar as despesas em `/usuarios/{uid}/despesas/{expenseId}`, garantimos que o controle de acesso está diretamente ligado ao ID do usuário, simplificando as regras de segurança e eliminando a necessidade de verificações hierárquicas complexas.\n\nA Independência de Autorização é alcançada porque cada documento de despesa pertence inerentemente a um usuário específico, identificado por `uid`. As regras de segurança precisam apenas verificar se `request.auth.uid == resource.data.uid` ao criar ou modificar uma despesa. Isso evita a necessidade de `get()` em documentos pais (usuários) para validar o acesso. Isso também facilita escritas em lote atômicas para recursos como copiar despesas para o próximo ano.\n\nAs QAPs são suportadas pela estrutura de propriedade direta `/usuarios/{uid}/despesas/{expenseId}`. As operações de listagem são protegidas verificando se `request.auth.uid == userId` nas regras, garantindo que os usuários só possam listar as despesas que lhes pertencem."
  }
}
